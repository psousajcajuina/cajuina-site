---
import type { Post } from '@/types';
import { fetchPosts } from '@/utils/blog';
import Image from './common/Image.astro';

import arrowNext from '@/assets/images/arrowNext.png';
import arrowPrev from '@/assets/images/arrowPrev.png';
import Button from './ui/Button.astro';

const posts = await fetchPosts();
---

<div class="my-6 flex h-[340px] w-full flex-col text-center">
  <h4 class="text-caju-heading-primary">NOTÍCIAS</h4>

  <div class="news-swiper relative">
    <div class="swiper news-swiper mx-auto mt-6">
      <div class="swiper-wrapper">
        {
          posts.map((post: Post) => (
            <div class="swiper-slide card font-inter w-auto max-w-[180px] text-left font-normal [&_>*:not(.card-image)]:px-1">
              {post.image && (
                <Image
                  src={post.image}
                  alt={post.title}
                  class="card-image mx-auto mb-3 h-[116px] w-full rounded-lg object-cover"
                />
              )}
              {/* Details */}
              <h5 class="text-caju-heading-primary h-[42px] text-lg">
                {post.title}
              </h5>
              {/* Detalhes */}
              <p class="mt-1 line-clamp-2 h-[60px] text-sm">
                {post.excerpt || post.content}
              </p>
              {/* Button */}
              <Button
                href={post.permalink}
                variant="green"
                class="h-[29px] w-[82px] transition-all duration-300"
              >
                Leia Mais
              </Button>
            </div>
          ))
        }
      </div>
    </div>

    <!-- Navigation Buttons -->
    <button
      class="swiper-button-prev !left-0 z-10 !flex !items-center !justify-center after:!content-['']"
      aria-label="Anterior"
    >
      <Image
        src={arrowPrev}
        alt=""
        class="size-12 transition-transform hover:scale-110 md:size-14"
      />
    </button>
    <button
      class="swiper-button-next !right-0 z-10 !flex !items-center !justify-center after:!content-['']"
      aria-label="Próximo"
    >
      <Image
        src={arrowNext}
        alt=""
        class="size-12 transition-transform hover:scale-110 md:size-14"
      />
    </button>
  </div>
</div>

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
/>

<script>
  import Swiper from 'swiper';
  import { Navigation, Autoplay } from 'swiper/modules';

  function initNewsSwiper(): void {
    const swiperEl = document.querySelector<HTMLElement>(
      '.news-swiper .swiper'
    );
    if (!swiperEl) return;

    new Swiper(swiperEl, {
      modules: [Autoplay],
      slidesPerView: 2,
      spaceBetween: 20,
      autoplay: {
        delay: 3500,
        disableOnInteraction: false,
      },
      navigation: {
        nextEl: '.swiper-button-next',
        prevEl: '.swiper-button-prev',
      },
    });
  }

  document.addEventListener('astro:page-load', initNewsSwiper);
</script>

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"
></script>

<style>
  .swiper {
    width: 350px;
    height: 300px;
  }
  .swipper-button-prev,
  .swiper-button-next {
    z-index: 999;
  }
</style>
